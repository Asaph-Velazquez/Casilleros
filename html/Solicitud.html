  <!DOCTYPE html>
  <html lang="es">
  <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>.::Solicitud de Casillero::.</title>
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous"></script>
      <link rel="stylesheet" href="../css/Navbar_y_slider.css">
      <link rel="stylesheet" href="/css/Solicitud_html/general.css">

      <script src="/js/Solicitud_html/limpiar_form.js"></script>
      <script src="/js/Solicitud_html/MostarOcultarCamposFormulario.js"></script>

  </head>
  <body> 
    <div class="d-flex justify-content-between align-items-center py-3 px-4">
        <a href="https://www.escom.ipn.mx/"><img src="/imgs/logoEscom.png" alt="Logo ESCOM" class="logo"></a>
        <p id="Encabezado" style="font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;"> 
          Escuela Superior de Cómputo 
        <br>
        Sistema de control de casilleros</p>
        <a href="https://www.ipn.mx/"><img src="/imgs/logoIPN.png" alt="Logo IPN" class="logo"></a>
    </div>
    <!-- NAVBAR -->
    <nav class="navbar navbar-expand-lg">
        <div class="container-fluid">
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="PagPrincipal.html">Inicio</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="Solicitud.html">Solicitud</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="acuse">Acuse</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="admin">Admin</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!--FORMULARIO-->
    <div class="container mt-4" id="Formulario">
      <h2>Solicitud de Casillero</h2>
        <div class="mb-3">
          <label class="form-label">Tipo de Solicitud</label>
          <div class="form-check">
              <input class="form-check-input" type="radio" name="tipoSolicitud" id="Registro">
              <label class="form-check-label" for="Registro">
                  Solicitud de Registro
              </label>
          </div>
          <div class="form-check">
              <input class="form-check-input" type="radio" name="tipoSolicitud" id="Renovacion">
              <label class="form-check-label" for="Renovacion">
                  Solicitud de Renovación
              </label>
          </div>
        </div>

        <div id="lockerAnterior" class="mb-3" style="display: none;">
          <label for="CasilleroAnterior" class="form-check-label">Número de Casillero Anterior</label>
          <input type="text" class="form-control" id="CasilleroAnterior" placeholder="Ingrese el número de su Casillero Anterior">
        </div>

        <div id="EleccionCURP" class="mb-3" style="display: none;">
          <label for="CURP" class="form-check-label">CURP</label>
          <input type="text" class="form-control" id="CURP" placeholder="Ingrese su CURP">
        </div>

        <div class="row"> 
          <div class="col-md-4 mb-3">
            <div id="EleccionNombre" class="mb-3" style="display: none;">
              <label for="Nombre" class="form-label">Nombre</label>
              <input type="text" class="form-control" id="Nombre" placeholder="Ingresa tu nombre">
            </div>
          </div>
          <div class="col-md-4 mb-3">
            <div id="PrimerApellido" class="mb-3" style="display: none;">
              <label for="ApellidoPaterno" class="form-label">Primer Apellido</label>
              <input type="text" class="form-control" id="ApellidoPaterno" placeholder="Ingresa tu Primer Apellido">
            </div>
          </div>

          <div class="col-md-4 mb-3">
            <div id="SegundoApellido" class="mb-3" style="display: none;">
              <label for="ApellidoMaterno" class="form-label">Segundo Apellido</label>
              <input type="text" class="form-control" id="ApellidoMaterno" placeholder="Ingresa tu Segundo Apellido">
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-md-6 mb-3">
            <div id="EleccionTelefono" class="mb-3" style="display: none;">
              <label for="Telefono" class="form-label">Telefono</label>
              <input type="number" class="form-control" id="Telefono" placeholder="55...">
            </div>
          </div>
          <div class="col-md-6 mb-3">
            <div id="EleccionCorreo" class="mb-3" style="display: none;">
              <label for="Correo" class="form-label">Correo Institucional</label>
              <input type="email" class="form-control" id="Correo" placeholder="abc@alumno.ipn.mx">
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-md-6 mb-3">
            <div id="EleccionBoleta" class="mb-3" style="display: none;">
              <label for="Boleta" class="form-label">Boleta</label>
              <input type="number" class="form-control" id="Boleta" placeholder="2018...">
            </div>
          </div>

          <div class="col-md-6 mb-3">
            <div id="EleccionEstatura" class="mb-3" style="display: none;">
              <label for="Estatura" class="form-label">Estatura</label>
              <input type="number" class="form-control" id="Estatura" placeholder="1.70">
            </div>
          </div>
        </div>
            
        <div class="row">
          <div class="col-md-6 mb-3">
            <div id="EleccionCredencial" class="mb-3" style="display: none;">
              <label for="Credencial" class="form-label">Credencial Vigente del IPN (PDF)</label>
              <input type="file" class="form-control" id="Credencial" placeholder="Sube tu Credencial">
            </div>
          </div>
        
          <div class="col-md-6 mb-3">
            <div id="EleccionHorario" class="mb-3" style="display: none;">
              <label for="Horario" class="form-label">Horario (PDF)</label>
              <input type="file" class="form-control" id="Horario" placeholder="Sube tu horario del SAES">
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-md-6 mb-3">
            <div id="EleccionUsuario" class="mb-3" style="display: none;">
              <label for="Usuario" class="form-label">Usuario</label>
              <input type="text" class="form-control" id="Usuario" placeholder="Ingresa tu Usuario">
            </div>
          </div>

          <div class="col-md-6 mb-3">
            <div id="EleccionContraseña" class="mb-3" style="display: none;">
              <label for="Contraseña" class="form-label">Contraseña</label>
              <input type="password" class="form-control" id="Contraseña" placeholder="Ingresa tu Contraseña">
            </div>
          </div>
        </div>

        <div class="row mt-4">
          <div class="col d-flex justify-content-between">
            <button type="button" class="btn btn-primary" id="Registrar"  style="display: none;" onclick="subida();">Registrar Solicitud</button>
            <button type="reset" class="btn btn-warning" id="Limpiar"  style="display: none;" onclick="LimpiarFormulario();">Limpiar</button>
          </div>
        </div>
    </div>

    <!--Validaciones-->
    <script>
      document.addEventListener('DOMContentLoaded', function(){
        const validaciones= {
          Nombre: {
            regex: /^[a-zA-ZáéíóúÁÉÍÓÚ\s]{3,30}$/,
            mensaje: "El nombre debe tener entre 3 y 30 caracteres"
        },
        ApellidoPaterno: {
            regex: /^[a-zA-ZáéíóúÁÉÍÓÚ\s]{3,30}$/,
            mensaje: "El apellido debe tener entre 3 y 30 caracteres"
        },
        ApellidoMaterno: {
            regex: /^[a-zA-ZáéíóúÁÉÍÓÚ\s]{3,30}$/,
            mensaje: "El apellido debe tener entre 3 y 30 caracteres"
        },
        Telefono: {
            regex: /^[0-9]{10}$/,
            mensaje: "El teléfono debe tener exactamente 10 dígitos"
        },
        Correo: {
            regex: /^[a-zA-Z0-9._%+-]+@alumno\.ipn\.mx$/,
            mensaje: "El correo debe ser del dominio alumno.ipn.mx"
        },
        Boleta: {
            regex: /^20[0-9]{8}$/,
            mensaje: "La boleta debe tener el formato 20XXXXXXXX"
        },
        Estatura: {
            regex: /^[0-2]\.[0-9]{2}$/,
            mensaje: "La estatura debe tener el formato X.XX"
        },
        CURP:{
            regex: /^[A-Z]{1}[AEIOUX]{1}[A-Z]{2}\d{2}(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])[HM](AS|BC|BS|CC|CS|CH|CL|CM|DF|DG|GT|GR|HG|JC|MC|MN|MS|NT|NL|OC|PL|QT|QR|SP|SL|SR|TC|TS|TL|VZ|YN|ZS|NE)[B-DF-HJ-NP-TV-Z]{3}[0-9A-Z]{1}\d{1}$/,
            mensaje: "El CURP debe tener el formato AAAA######HMAAAANNA"
        }
        };

        function validarCampo(campo){
        //validamos cada campo
        const tipo = campo.id;
        const valor = campo.value.trim(); //elimina espacios en blanco al inicio y al final
        const validacion=  validaciones[tipo]; 

        if(!validacion){
          return false; //si no hay validación, no hacemos nada
        }

        const esValido = validacion.regex.test(valor);
        const errorDiv= campo.nextElementSibling; //obtenemos el siguiente elemento del DOM

        if(esValido){
          campo.classList.remove('is-invalid');
          campo.classList.add('is-valid');
          errorDiv.textContent= ''; //limpiamos el mensaje de error
        }
        else{
          campo.classList.remove('is-valid');
          campo.classList.add('is-invalid');
          errorDiv.textContent= validacion.mensaje;
        }
        return esValido;
      }

      //validamos todos los campos
      function validarFormulario(){
        const campos = document.querySelectorAll('#Formulario input');
        let esValido = true;

        campos.forEach(campo=>{
          const resultado = validarCampo(campo);
          if(!resultado){
            esValido = false;
          }
        });
        return esValido;
      }

      //agregamos los eventos a los campos
      const inputs = document.querySelectorAll('#Formulario input');

      inputs.forEach(input=>{
        input.addEventListener('input', ()=>validarCampo(input));
      });

      //validamos el formulario al intentar enviarlo
      const formulario = document.querySelector('#Formulario');
      formulario.addEventListener('submit', function(event){
        if(!validarFormulario()){
          event.preventDefault();
          alert('Hay errores en el formulario');
        }
      })

      //finalmente agregamos la funcion para meter en el onclick del botton
      function subida(){
        const formularioValido = validarFormulario();
        if(!formularioValido){
          alert('Hay errores en el formulario');
          event.preventDefault(); //no enviadmos el formulario si hay errores
        }else{
          //emepzamos a recopilar los datos 
          const tipoDeSolicitud = document.getElementById('Renovacion').checked? 'Renovación': 'Registro';
          const casilleroAnterior = document.getElementById('CasilleroAnterior')?.value || 'N/A';
          const datos={
            'Tipo de Solicitud': tipoDeSolicitud,
            'Casillero Anterior': casilleroAnterior,
            'CURP': document.getElementById('CURP').value,
            'Nombre': document.getElementById('Nombre').value,
            'Primer Apellido': document.getElementById('ApellidoPaterno').value,
            'Segundo Apellido': document.getElementById('ApellidoMaterno').value,
            'Telefono': document.getElementById('Telefono').value,
            'Correo': document.getElementById('Correo').value,
            'Boleta': document.getElementById('Boleta').value,
            'Estatura': document.getElementById('Estatura').value,
            'Credencial': document.getElementById('Credencial').value,
            'Horario': document.getElementById('Horario').value,
            'Usuario': document.getElementById('Usuario').value,
            'Contraseña': document.getElementById('Contraseña').value
          };
          //mostramos los datos en un modal
          let contenidoHTML='';
          for(const propiedad in datos){
            contenidoHTML+=`<p><strong>${propiedad}:</strong> ${datos[propiedad]}</p>`;
          }

          //insertamos el contenido en el modal
          document.getElementById('DatosModal').querySelector('.modal-body').innerHTML=contenidoHTML;
          const modal = new bootstrap.Modal(document.getElementById('DatosModal'));
          modal.show();
        }
      }
      });
    </script>

    <div class="modal fade" id="DatosModal" tabindex="-1" aria-labelledby="modalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="modalLabel">Verificación de datos</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary">Guardar cambios</button>
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
          </div>
        </div>
      </div>
    </div>
    
  </body>
  </html>